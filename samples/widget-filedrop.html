<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Widget FileDrop æ‹–æ‹½æ–‡ä»¶ â€” WebCom Samples</title>
<script src="_base.js"></script>
<style>
.drop-zone {
  border: 2px dashed #94a3b8;
  border-radius: 10px;
  padding: 2em;
  text-align: center;
  color: #64748b;
  transition: border-color .2s, background .2s;
  cursor: pointer;
}
.drop-zone.dragover {
  border-color: #0284c7;
  background: #eff6ff;
  color: #0284c7;
}
.file-list { margin-top: 1em; }
.file-item { display:flex;align-items:center;gap:.5em;padding:.4em .8em;background:#f8fafc;border-radius:4px;margin-top:.4em;font-size:.9em; }
</style>
</head>
<body>
<div class="page-wrap">
<h1>FileDrop â€” æ‹–æ‹½æ–‡ä»¶</h1>
<p class="subtitle">å°†æ–‡ä»¶æ‹–æ‹½åˆ°åŒºåŸŸæˆ–ç‚¹å‡»é€‰æ‹©ï¼Œè·å– File å¯¹è±¡åˆ—è¡¨ï¼Œä¸ç»‘å®šä¸Šä¼ é€»è¾‘ã€‚</p>

<h2>1. åŸºç¡€æ‹–æ‹½åŒºåŸŸ</h2>
<div class="demo-block">
  <div id="drop-basic" class="drop-zone">
    <div style="font-size:2em;margin-bottom:.4em">ğŸ“‚</div>
    <p>å°†æ–‡ä»¶æ‹–æ‹½åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
    <p style="font-size:.85em;margin-top:.3em;color:#94a3b8">æ”¯æŒä»»æ„æ–‡ä»¶ç±»å‹</p>
  </div>
  <div class="file-list" id="file-list-1"></div>
</div>
<pre class="code-block">import { bindFileDrop } from '../src/Widget/FileDrop.js';

bindFileDrop(dropZone, (files) => {
  files.forEach(file => {
    console.log(file.name, file.size, file.type);
  });
});</pre>

<h2>2. é™å®šæ–‡ä»¶ç±»å‹</h2>
<div class="demo-block">
  <div id="drop-img" class="drop-zone">
    <div style="font-size:2em;margin-bottom:.4em">ğŸ–¼ï¸</div>
    <p>ä»…æ¥å—å›¾ç‰‡æ–‡ä»¶ï¼ˆimage/*ï¼‰</p>
    <p style="font-size:.85em;margin-top:.3em;color:#94a3b8">PNG / JPG / GIF / WebP</p>
  </div>
  <div class="file-list" id="file-list-2"></div>
</div>
<pre class="code-block">import { bindFileDrop } from '../src/Widget/FileDrop.js';

bindFileDrop(dropZone, (files) => {
  // files å·²è¿‡æ»¤ä¸ºå›¾ç‰‡
}, {
  accept: 'image/*',
  onReject: (files) => alert('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹'),
});</pre>

<h2>3. å¤šæ–‡ä»¶ + å¤§å°é™åˆ¶</h2>
<div class="demo-block">
  <div id="drop-multi" class="drop-zone">
    <div style="font-size:2em;margin-bottom:.4em">ğŸ“¦</div>
    <p>æ‹–å…¥å¤šä¸ªæ–‡ä»¶ï¼ˆå•ä¸ª â‰¤ 2MBï¼‰</p>
  </div>
  <div class="file-list" id="file-list-3"></div>
</div>
<pre class="code-block">bindFileDrop(dropZone, (files) => {
  // files ä¸º File[] æ•°ç»„
}, {
  multiple: true,
  maxSize: 2 * 1024 * 1024, // 2MB
  onSizeExceed: (file) => {
    alert(`${file.name} è¶…è¿‡å¤§å°é™åˆ¶`);
  }
});</pre>

<h2>å‚æ•°è¯´æ˜</h2>
<table class="param-table">
  <tr><th>å‚æ•°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr>
  <tr><td>element</td><td>HTMLElement</td><td>æ‹–æ‹½åŒºåŸŸå…ƒç´ </td></tr>
  <tr><td>onDrop</td><td>Function(files: File[])</td><td>æ–‡ä»¶æ”¾å…¥å›è°ƒ</td></tr>
  <tr><td>option.accept</td><td>string</td><td>MIME ç±»å‹è¿‡æ»¤ï¼Œå¦‚ 'image/*', '.pdf'</td></tr>
  <tr><td>option.multiple</td><td>boolean</td><td>æ˜¯å¦å…è®¸å¤šæ–‡ä»¶ï¼Œé»˜è®¤ true</td></tr>
  <tr><td>option.maxSize</td><td>number</td><td>å•ä¸ªæ–‡ä»¶æœ€å¤§å­—èŠ‚æ•°</td></tr>
  <tr><td>option.onReject</td><td>Function(files)</td><td>æ–‡ä»¶ç±»å‹ä¸ç¬¦æ—¶å›è°ƒ</td></tr>
</table>
</div>

<script type="module">
import { bindFileDrop } from '../src/Widget/FileDrop.js';
import { formatSize } from '../src/Lang/String.js';

function getIcon(type) {
  if (type.startsWith('image/')) return 'ğŸ–¼ï¸';
  if (type.startsWith('video/')) return 'ğŸ¬';
  if (type.startsWith('audio/')) return 'ğŸµ';
  if (type.includes('pdf')) return 'ğŸ“„';
  return 'ğŸ“';
}

function renderFiles(listEl, files, errorMsg) {
  if (errorMsg) {
    listEl.innerHTML = `<div style="color:#dc2626;margin-top:.5em">${errorMsg}</div>`;
    return;
  }
  listEl.innerHTML = Array.from(files).map(f =>
    `<div class="file-item">${getIcon(f.type)} <b>${f.name}</b> <span style="color:#94a3b8;margin-left:auto">${formatSize(f.size)} Â· ${f.type || 'æœªçŸ¥ç±»å‹'}</span></div>`
  ).join('');
}

// 1. åŸºç¡€
bindFileDrop(document.getElementById('drop-basic'), (files) => {
  renderFiles(document.getElementById('file-list-1'), files);
});

// 2. ä»…å›¾ç‰‡
bindFileDrop(document.getElementById('drop-img'), (files) => {
  renderFiles(document.getElementById('file-list-2'), files);
}, {
  accept: 'image/*',
  onReject: (files) => {
    renderFiles(document.getElementById('file-list-2'), [], `âŒ ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼š${files.map(f=>f.name).join(', ')}`);
  }
});

// 3. å¤šæ–‡ä»¶+é™å¤§å°
bindFileDrop(document.getElementById('drop-multi'), (files) => {
  renderFiles(document.getElementById('file-list-3'), files);
}, {
  multiple: true,
  maxSize: 2 * 1024 * 1024,
  onSizeExceed: (file) => {
    renderFiles(document.getElementById('file-list-3'), [], `âŒ "${file.name}" è¶…è¿‡ 2MB å¤§å°é™åˆ¶`);
  }
});

// Drag-over æ ·å¼
['drop-basic', 'drop-img', 'drop-multi'].forEach(id => {
  const el = document.getElementById(id);
  el.addEventListener('dragover', () => el.classList.add('dragover'));
  el.addEventListener('dragleave', () => el.classList.remove('dragover'));
  el.addEventListener('drop', () => el.classList.remove('dragover'));
});
</script>
</body>
</html>
