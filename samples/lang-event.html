<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lang Event äº‹ä»¶å·¥å…· â€” WebCom Samples</title>
<script src="_base.js"></script>
</head>
<body>
<div class="page-wrap">
<h1>Event â€” äº‹ä»¶å·¥å…·</h1>
<p class="subtitle">æä¾›è‡ªå®šä¹‰å‘å¸ƒè®¢é˜…äº‹ä»¶ï¼ˆBizEventï¼‰ã€çƒ­é”®ç»‘å®šã€äº‹ä»¶å§”æ‰˜ã€èŠ‚ç‚¹æ¿€æ´»ç­‰å·¥å…·ã€‚</p>

<h2>1. BizEvent â€” è‡ªå®šä¹‰å‘å¸ƒ/è®¢é˜…</h2>
<div class="demo-block">
  <button id="btn-fire">è§¦å‘äº‹ä»¶</button>
  <button id="btn-bind">è®¢é˜…äº‹ä»¶</button>
  <button id="btn-unbind">å–æ¶ˆè®¢é˜…</button>
  <div id="biz-log" class="result-box" style="margin-top:0.8em">ï¼ˆäº‹ä»¶æ—¥å¿—ï¼‰</div>
</div>
<pre class="code-block">import { BizEvent } from '../src/Lang/Event.js';

const bus = new BizEvent();

// è®¢é˜…
const off = bus.listen((msg) => console.log('æ”¶åˆ°ï¼š', msg));

// å‘å¸ƒ
bus.fire('Hello World');

// å–æ¶ˆè®¢é˜…
off();</pre>

<h2>2. bindHotKeys â€” çƒ­é”®ç»‘å®š</h2>
<div class="demo-block">
  <p>åœ¨ä¸‹æ–¹è¾“å…¥æ¡†å†…å°è¯•çƒ­é”®ï¼š<kbd>Ctrl+S</kbd>ï¼ˆä¿å­˜ï¼‰ã€<kbd>Ctrl+Z</kbd>ï¼ˆæ’¤é”€ï¼‰</p>
  <textarea id="hotkey-area" placeholder="ç‚¹å‡»æ­¤å¤„ï¼Œç„¶åæŒ‰ Ctrl+S æˆ– Ctrl+Z" style="width:100%;height:60px;padding:0.5em"></textarea>
  <div id="hotkey-result" class="result-box" style="margin-top:0.5em">ï¼ˆçƒ­é”®æ—¥å¿—ï¼‰</div>
</div>
<pre class="code-block">import { bindHotKeys } from '../src/Lang/Event.js';

bindHotKeys({
  'ctrl+s': (e) => { e.preventDefault(); console.log('ä¿å­˜ triggered'); },
  'ctrl+z': (e) => { console.log('æ’¤é”€ triggered'); },
}, textarea);</pre>

<h2>3. eventDelegate â€” äº‹ä»¶å§”æ‰˜</h2>
<div class="demo-block">
  <ul id="delegate-list" style="padding:0;list-style:none">
    <li data-id="1" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee">Item 1</li>
    <li data-id="2" style="padding:8px 12px;cursor:pointer;border-bottom:1px solid #eee">Item 2</li>
    <li data-id="3" style="padding:8px 12px;cursor:pointer">Item 3</li>
  </ul>
  <button id="btn-add-item" style="margin-top:0.5em">åŠ¨æ€æ·»åŠ ä¸€é¡¹</button>
  <div id="delegate-result" class="result-box" style="margin-top:0.5em">ï¼ˆç‚¹å‡»åˆ—è¡¨é¡¹ï¼‰</div>
</div>
<pre class="code-block">import { eventDelegate } from '../src/Lang/Event.js';

// äº‹ä»¶ç»‘å®šåœ¨çˆ¶å®¹å™¨ï¼Œè‡ªåŠ¨å¤„ç†åŠ¨æ€å­èŠ‚ç‚¹
eventDelegate(container, 'li', 'click', (e, target) => {
  console.log('ç‚¹å‡»äº† idï¼š', target.dataset.id);
});</pre>

<h2>4. onDocReady â€” æ–‡æ¡£å°±ç»ª</h2>
<div class="demo-block" id="ready-block"></div>
<pre class="code-block">import { onDocReady } from '../src/Lang/Event.js';

onDocReady(() => {
  // DOM å®Œå…¨åŠ è½½åæ‰§è¡Œ
  console.log('Document ready!');
});</pre>

<h2>å‚æ•°è¯´æ˜ â€” BizEvent</h2>
<table class="param-table">
  <tr><th>æ–¹æ³•</th><th>å‚æ•°</th><th>è¿”å›å€¼</th><th>è¯´æ˜</th></tr>
  <tr><td>new BizEvent()</td><td>â€”</td><td>BizEvent å®ä¾‹</td><td>åˆ›å»ºäº‹ä»¶æ€»çº¿</td></tr>
  <tr><td>.listen(callback)</td><td>callback: Function</td><td>è§£ç»‘å‡½æ•°</td><td>è®¢é˜…äº‹ä»¶ï¼Œè¿”å›è§£ç»‘å‡½æ•°</td></tr>
  <tr><td>.fire(...args)</td><td>ä»»æ„å‚æ•°</td><td>void</td><td>è§¦å‘äº‹ä»¶ï¼Œä¼ é€’å‚æ•°ç»™æ‰€æœ‰è®¢é˜…è€…</td></tr>
  <tr><td>.off(callback)</td><td>callback: Function</td><td>void</td><td>æ‰‹åŠ¨å–æ¶ˆæŒ‡å®šè®¢é˜…</td></tr>
  <tr><td>.destroy()</td><td>â€”</td><td>void</td><td>é”€æ¯æ‰€æœ‰è®¢é˜…</td></tr>
</table>
</div>

<script type="module">
import { BizEvent, bindHotKeys, eventDelegate, onDocReady } from '../src/Lang/Event.js';

// BizEvent
const bus = new BizEvent();
let listenerOff = null;
const bizLog = document.getElementById('biz-log');

function logMsg(msg) {
  const d = document.createElement('div');
  d.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
  bizLog.appendChild(d);
  if (bizLog.children.length > 5) bizLog.removeChild(bizLog.firstChild);
}

document.getElementById('btn-bind').onclick = () => {
  if (!listenerOff) {
    listenerOff = bus.listen((payload) => logMsg(`æ”¶åˆ°äº‹ä»¶ï¼š${JSON.stringify(payload)}`));
    logMsg('âœ… å·²è®¢é˜…äº‹ä»¶');
  } else {
    logMsg('âš ï¸ å·²ç»è®¢é˜…äº†ï¼Œå…ˆå–æ¶ˆè®¢é˜…å†é‡æ–°è®¢é˜…');
  }
};

document.getElementById('btn-fire').onclick = () => {
  bus.fire({ time: Date.now(), msg: 'hello' });
};

document.getElementById('btn-unbind').onclick = () => {
  if (listenerOff) {
    listenerOff();
    listenerOff = null;
    logMsg('ğŸ”‡ å·²å–æ¶ˆè®¢é˜…');
  } else {
    logMsg('âš ï¸ å½“å‰æœªè®¢é˜…');
  }
};

// bindHotKeys
const hotkeyArea = document.getElementById('hotkey-area');
const hotkeyResult = document.getElementById('hotkey-result');
bindHotKeys({
  'ctrl+s': (e) => {
    e.preventDefault();
    const d = document.createElement('div');
    d.textContent = `[${new Date().toLocaleTimeString()}] Ctrl+Sï¼ˆä¿å­˜ï¼‰è§¦å‘`;
    hotkeyResult.appendChild(d);
  },
  'ctrl+z': (e) => {
    const d = document.createElement('div');
    d.textContent = `[${new Date().toLocaleTimeString()}] Ctrl+Zï¼ˆæ’¤é”€ï¼‰è§¦å‘`;
    hotkeyResult.appendChild(d);
  },
}, hotkeyArea);

// eventDelegate
const delegateList = document.getElementById('delegate-list');
const delegateResult = document.getElementById('delegate-result');
eventDelegate(delegateList, 'li', 'click', (e, target) => {
  delegateResult.textContent = `ç‚¹å‡»äº† id="${target.dataset.id}"ï¼Œæ–‡æœ¬ï¼š"${target.textContent.trim()}"`;
  target.style.background = '#fef9c3';
  setTimeout(() => target.style.background = '', 600);
});

let itemCount = 3;
document.getElementById('btn-add-item').onclick = () => {
  itemCount++;
  const li = document.createElement('li');
  li.dataset.id = itemCount;
  li.textContent = `Item ${itemCount}ï¼ˆåŠ¨æ€æ·»åŠ ï¼‰`;
  li.style.cssText = 'padding:8px 12px;cursor:pointer;border-top:1px solid #eee;color:#0284c7';
  delegateList.appendChild(li);
};

// onDocReady
onDocReady(() => {
  document.getElementById('ready-block').innerHTML =
    `âœ… onDocReady å›è°ƒå·²æ‰§è¡Œï¼Œå½“å‰æ—¶é—´ï¼š<b>${new Date().toLocaleTimeString()}</b>`;
});
</script>
</body>
</html>
